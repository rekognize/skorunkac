{% extends "base.html" %}
{% load crispy_forms_tags static %}


{% block content %}

    <div class="container mt-4">

        <div class="row">

            <h2 class="mb-4">
                <small>Testi tamamladın. katıldığın için teşekkürler!</small>
                <br>
                Toplumsal cinsiyet eşitliği skorun:
                <span class="text-{% if poll.score >= poll_settings.SUCCESS_SCORE %}success{% elif poll.score >= poll_settings.FAIL_SCORE %}warning{% else %}danger{% endif %}">
                    {{ poll.score }}
                </span>
            </h2>

            <div class="w-100"></div>

            {% if session_score.count >= poll_settings.DISPLAY_AVERAGE_SESSION_TODAY_THRESHOLD %}
            <p>
                Bugün {% if poll.session %}<strong>{{ poll.session }}</strong> oturumunda{% endif %} ankete katılan <strong>{{ session_score_today.count }}</strong> kişinin ortalaması <strong>{{ session_score_today.avg|floatformat:1 }}</strong>
            </p>
            <div class="w-100"></div>
            {% endif %}


            {% if session_score.count >= poll_settings.DISPLAY_AVERAGE_SESSION_THRESHOLD %}
            <p>
                Tüm zamanlarda {% if poll.session %}<strong>{{ poll.session }}</strong> oturumunda{% endif %} ankete katılan <strong>{{ session_score.count }}</strong> kişinin ortalaması <strong>{{ session_score.avg|floatformat:1 }}</strong>
            </p>
            <div class="w-100"></div>
            {% endif %}


            {% if global_score.count >= poll_settings.DISPLAY_AVERAGE_TOTAL_THRESHOLD %}
            <p>
                Şimdiye kadar ankete katılan <strong>{{ global_score.count }}</strong> kişinin ortalaması <strong>{{ global_score.avg|floatformat:1 }}</strong>
            </p>
            <div class="w-100"></div>
            {% endif %}

        </div>

        <div class="row">

            <h3 class="mt-4">
                Kategorilere göre skorun:
            </h3>

            <div class="w-100"></div>

            <table>
            {% for cat, scores in scores_by_category %}
                {% with scores.score as score %}
                <tr class="text-{% if score >= poll_settings.SUCCESS_SCORE %}success{% elif score >= poll_settings.FAIL_SCORE %}warning{% else %}danger{% endif %}">
                    <td>{{ cat.name }}</td>
                    <td class="text-right">{{ score }}</td>
                </tr>
                {% endwith %}
            {% endfor %}
            </table>

        </div>

        <div class="row mt-4">

            {% if strongest_category.1.score < poll_settings.FAIL_SCORE %}

                <h3>Maalesef hiçbir kategoriden iyi puan alamadın!</h3>

            {% else %}

                <p class="lead">
                    En iyi olduğun kategori
                    <em>{{ strongest_category.0.name }}</em>;
                    bu kategorideki skorun
                    {% with strongest_category.1.score as score %}
                    <span class="text-{% if score >= poll_settings.SUCCESS_SCORE %}success{% elif score >= poll_settings.FAIL_SCORE %}warning{% else %}danger{% endif %}">
                        {{ score }}
                    </span>
                    {% endwith %}
                </p>

                <div class="w-100 mt-2"></div>

            {% endif %}


            {% if weakest_category.1.score > poll_settings.SUCCESS_SCORE %}

                <h3>Tebrikler, tüm kategorilerden yüksek puan aldın!</h3>

            {% else %}

                <p class="lead">
                    En zayıf olduğun kategori
                    <em>{{ weakest_category.0.name }}</em>;
                    bu kategorideki skorun
                    {% with weakest_category.1.score as score %}
                    <span class="text-{% if score >= poll_settings.SUCCESS_SCORE %}success{% elif score >= poll_settings.FAIL_SCORE %}warning{% else %}danger{% endif %}">
                        {{ score }}
                    </span>
                    {% endwith %}
                </p>

                <div class="w-100 mt-2"></div>

                {% comment %}
                <blockquote class="blockquote">
                    <strong>{{ weakest_category.0.name }}</strong> konusunda kendini geliştirmek için derlediğimiz kaynaklara göz atmak ister misin?
                </blockquote>

                <div class="w-100"></div>

                <a href="{% url 'suggest' poll_id=poll.id %}" class="btn btn-primary">Kaynakları göster</a>
                {% endcomment %}

            {% endif %}

            <p class="mt-5">
                SKORUN KAÇ oyunumuza katıldığın, görüşlerini bizimle paylaştığın için teşekkür ederiz.
                Bu oyunda derlenen veriler hiçbir şekilde başka kuruluşlarla paylaşılmayacaktır.
                Yanıtlar genel istatistiki veri olarak analiz edilecek ve derlenecektir.
            </p>

            <div class="text-center w-100">
                <p class="lead">
                    <span class="small">Teknosa'nın katkılarıyla</span>
                    <br>
                    <img src="{% static "teknosa.png" %}" style="height: 2em">
                </p>
            </div>

        </div>
    </div>

{% endblock %}
